# RocketMQ



![领域模型](D:\blog\docs\MQ\img\组成.assets\mainarchi-9b036e7ff5133d050950f25838367a17.png)



## 架构组成

### Producer

消息的生产者

### Conumser

消息的消费者

### Broker

接收并存储生产者生产的消息。向消费者传输消息提供其消费。

Broker分为master和slave，会进行数据同步。

### NameServer

路由注册中心。

Producer、Conumser、broker都会连接NameServer。

Broker是向每一台NameServer注册自己的路由信息。所以每一个NameServer实例上面都保存一份完整的路由信息。当某个NameServer因某种原因下线了，Broker仍然可以向其它NameServer同步其路由信息，Producer,Consumer仍然可以动态感知Broker的路由的信息。

Producer和Conumser通过NameServer就可以知道整个Broker集群的路由信息

### Topic

一个Borker中有一个或多个Topic

一个Topic中有一个或多个MessageQueue

同一个 Topic 下的 Message 会分散存储在各个 Broker 上，每台 Broker 实际上**存储的消息内容是不同的**，将这些 Broker 存储的消息全部加起来就是全部的数据。**一来能够容灾，二来能够防止数据倾斜**。

#### MessageQueue 

在kafka中叫Partition，每个 MessageQueue 内部是有序的。

一个topic下面可以设置多个MessageQueue ，分散的 MessageQueue 一起组成了一个完整的 Topic。



### borker、broker、queue三者关系

![img](D:\blog\docs\MQ\img\组成.assets\a0b5d1dedee74e3cbacf6c63dd328c97tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.awebp)

在图中，共有2个broker，2个topic，每个topic都有4个队列。在producer发送消息时，是发送到具体的队列上，consumer获取消息时，也是从队列上获取。